<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta charset="utf-8"><meta name="keywords" content="javascript, modules, module, convert, commonjs, AMD, UMD, UMDjs, format, converter, conversion, requirejs, require, define, browserify, dependency, dependencies, bundle, package"><meta name="description" content="Javascript Universal Module &amp; Resource Converter: convert modules from commonjs to AMD, AMD modules to commonjs, requirejs to nodejs to UMD, to standalone optimized .js"><title>combined Template - uRequire: JavaScript Universal Module &amp; Resource Converter: convert modules from AMD to nodejs, commonjs and back, to UMD, to plain script .js</title><link rel="stylesheet" href="/uRequire/css/main.css"><link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Lato:400,700"><link rel="shortcut icon" href="/uRequire/img/favicon.ico" type="image/x-icon"><!--script--><!--  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){--><!--  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),--><!--  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)--><!--  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');--><!----><!--  ga('create', 'UA-41565621-1', 'http://anodynos.github.io/uRequire');--><!--  ga('send', 'pageview');--></head><body class="page-docs page-secondary"><a href="https://github.com/anodynos/urequire"><img style="position: absolute; top: 0; right: 0; border: 0; z-index: 1;" src="/uRequire/img/github_forkme_right_orange_ff7600.png" alt="Fork me on GitHub"></a><div class="navbar navbar-inverse"><div class="navbar-inner"><div class="container"><a href="http://anodynos.github.io/uRequire" class="brand"><img src="/uRequire/img/urequire-logo.png" alt="convert, javascript, modules, commonjs, requirejs, nodejs, AMD, UMD, dependencies, resources, conversion, workflow, in-memory, asset, pipeline" class="logo"></a><div class="nav-collapse collapse"><ul class="nav"><li><a href="/uRequire/docs/features.html"><i class="icon-arrow-right"></i><span>uRequire Features</span></a></li><li><a href="/uRequire/docs/quick-introduction.html"><i class="icon-document-alt-stroke"></i><span>Documentation</span></a></li><li><a href="/uRequire/docs/masterdefaultsconfig.coffee.html"><i class="icon-cog"></i><span>uRequire Config</span></a></li><li><a href="/uRequire/docs/resourceconverters.coffee.html"><i class="icon-power-cord"></i><span>Resource Converters</span></a></li></ul></div></div></div></div><div class="content"><div class="container combined-template"><div class="row-fluid"><div class="span9 page"><div class="hero-unit docs"><h1>combined Template</h1><h2><a class="anchor" href="#universal-combined-module-optimization-for-web-amd-nodejs" id="universal-combined-module-optimization-for-web-amd-nodejs"></a>Universal <code>combined</code> Module optimization for Web, AMD &amp; nodejs!</h2>
<p>The <code>combined</code> <a href="masterdefaultsconfig.coffee#build.template">build.template</a> builds your bundle as a single <code>.js</code> file, ready to be deployed anywhere! </p>
<p>Its one of the most important features of uRequire, as the single <code>.js</code> file is a 3-fold build that runs as-is :</p>
<ul>
<li><p>on <code>Web/Script</code>, via a simple &lt;script&gt; tag on HTML.</p>
</li>
<li><p><code>Web/AMD</code> </p>
</li>
<li><p><code>nodejs</code> </p>
</li>
</ul>
<p>See <a href="deployment#deployment-options-for-combined-template">combined deployment</a> for details.</p>
<h2><a class="anchor" href="#how-it-works" id="how-it-works"></a>How it works</h2>
<p>The <code>combined</code> template actually uses a tweaked optimization of <code>r.js</code> using <code>almond</code> to offer an AMD runtime independent (yet AMD runtime compatible) execution.</p>
<p>Globals/externals (like &#39;lodash&#39; or &#39;Backbone&#39;) are not inlined, but are used either from <code>window</code>, the <em>AMD config</em> or <em>nodejs <code>require</code></em>, depending on where its executing. </p>
<p>The <code>combined</code> script automagically <em>detects at runtime where it is executing</em> and chooses appropriately.</p>
<h2><a class="anchor" href="#bundle-exported-dependencies" id="bundle-exported-dependencies"></a>Bundle exported dependencies</h2>
<p>All dependencies/variables declared in config&#39;s <a href="masterdefaultsconfig.coffee#bundle.dependencies.exports.bundle">bundle.dependencies.exports.bundle</a> are available through the bundle, and are normally injected <strong>in every module</strong>. </p>
<p>In <a href="combined-template">combined template</a> they are not injected in each module, <strong>to save on size/speed</strong>. Instead, they are available through the combined closure, to save from being <code>define</code>/<code>require</code> -ed in each module.</p>
<h1><a class="anchor" href="#merging-code" id="merging-code"></a>Merging Code</h1>
<p>With combined template you can greatly reduce the size of the pre-minified code.</p>
<p>Most of this is automated, but you need to bear a few things in mind.</p>
<h2><a class="anchor" href="#merging-pre-define-ifi-statements" id="merging-pre-define-ifi-statements"></a>Merging pre-define IFI* statements</h2>
<p>(* IFI = <a href="http://stackoverflow.com/questions/939386/immediate-function-invocation-syntax">Immediate function invocation</a> also known as Immediately Invoked Function Expression (IIFE))</p>
<p>When a Module is written in a <em>coffeescript family language</em> (Livescript, coco, iced etc) and is using the AMD <code>define()</code> format, all generated code like <code>__extends</code>, <code>__slice</code> or <code>__curry$</code> goes outside the <code>define()</code> when compiled. For example:</p>
<pre><code class="lang-coffeescript">define [.., ..], (.., ..)-&gt;
  <span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">extends</span> <span class="title">B</span></span></code></pre>
<p> will compile to something like</p>
<pre><code class="lang-js">(<span class="reserved">function</span>() {
    <span class="reserved">var</span> __slice=..., __extends=..., __curry$ = ...; <span class="regexp">//</span> these are the preDefineIFI statements

    define([.., ..], <span class="reserved">function</span>(.., ..){...});    
}());</code></pre>
<p>These generated code fragments are present in each module that uses them, wasting space:  you &#39;ll end up with delivered code that has many duplicate code, especially in coffee-* derivatives with complex generated code like iced or livescript.</p>
<p>The combined template in uRequire &gt;= v0.6 recognises any pre-define IFI statement/declaration and merges them in one place, available through the closure for the whole combined bundle. <strong>This again saves on size/speed</strong>.</p>
<p>Ro take advantage of this:</p>
<ul>
<li><p>Just author in AMD &amp; compile without <code>--bare</code> (or dont compile your .coffee, let uRequire do it)</p>
</li>
<li><p>Use this super simple RC that wraps you node-js module and <strong>turns them into AMD BEFORE being compiled</strong> from .coffee to .js <a href="resourceconverters.coffee#some-coffeescript-define-and-merge">Resource Converters</a>.</p>
</li>
</ul>
<h2><a class="anchor" href="#user-defined-common-merged-code" id="user-defined-common-merged-code"></a>User defined common &amp; merged code</h2>
<p>First check <a href="masterdefaultsconfig.coffee#bundle.commoncode">bundle.commonCode</a>, on how to inject common code in all you modules, but then are written only once on the <code>combined.js</code>.</p>
<p>Then check <a href="resourceconverters.coffee#module.mergedcode">module.mergedCode</a> which is similar, but can selectively omit injection in some files &amp; require a <a href="resourceconverteres.coffee">ResourceConverter</a>.</p>
</div></div><div class="span3"><div class="well sidebar-nav"><ul class="nav nav-list"><li class="nav-header"><i class="icon-document-alt-stroke"></i><span>Introduction</span></li><li><a href="/uRequire/docs/quick-introduction.html">Quick Introduction</a></li><li><a href="/uRequire/docs/ultimate-aims.html">Ultimate Aims</a></li><li><a href="/uRequire/docs/features.html">Features</a></li><li><a href="/uRequire/docs/installing-urequire.html">Installing uRequire</a></li></ul><ul class="nav nav-list"><li class="nav-header"><span>Using &amp; Configuration</span></li><li><a href="/uRequire/docs/using-urequire.html">Using uRequire</a></li><li><a href="/uRequire/docs/masterdefaultsconfig.coffee.html">MasterDefaultsConfig.coffee</a></li><li><a href="/uRequire/docs/resourceconverters.coffee.html">ResourceConverters.coffee</a></li><li><a href="/uRequire/docs/types-and-derive.html">Types and Derive</a></li><li><a href="/uRequire/docs/tags-legend.html">Tags Legend</a></li><li><a href="/uRequire/docs/cli-options.html">CLI Options</a></li></ul><ul class="nav nav-list"><li class="nav-header"><span>Module Authoring</span></li><li><a href="/uRequire/docs/universal-module-format.html">Universal Module Format</a></li><li><a href="/uRequire/docs/flexible-path-conventions.html">Flexible Path Conventions</a></li><li><a href="/uRequire/docs/synchronous-require.html">Synchronous Require</a></li><li><a href="/uRequire/docs/asynchronous-require.html">Asynchronous Require</a></li><li><a href="/uRequire/docs/exporting-modules.html">Exporting Modules</a></li><li><a href="/uRequire/docs/mappings.html">Mappings</a></li><li><a href="/uRequire/docs/requirejs-loader-plugins.html">RequireJS Loader Plugins</a></li><li><a href="/uRequire/docs/authoring-notes-and-warnings.html">Authoring Notes and Warnings</a></li><li><a href="/uRequire/docs/deployment.html">Deployment</a></li></ul><ul class="nav nav-list"><li class="nav-header"><span>Conversion Templates</span></li><li><a href="/uRequire/docs/umd-template.html">UMD Template</a></li><li><a href="/uRequire/docs/amd-template.html">AMD Template</a></li><li><a href="/uRequire/docs/nodejs-template.html">nodejs Template</a></li><li><a href="/uRequire/docs/combined-template.html">combined Template</a></li><li><a href="/uRequire/docs/your-custom-template.html">your-custom Template</a></li></ul><ul class="nav nav-list"><li class="nav-header"><span>Misc</span></li><li><a href="/uRequire/docs/frequently-asked-questions.html">Frequently Asked Questions</a></li><li><a href="/uRequire/docs/history.html">History</a></li><li><a href="/uRequire/docs/future-directions.html">Future Directions</a></li><li><a href="/uRequire/docs/acknowledgements.html">Acknowledgements</a></li><li><a href="/uRequire/docs/contributing.html">Contributing</a></li></ul><div class="advertisements">Powered by <a href="http://github.com/anodynos/uberscore">uBerscore</a>, the unorthodox _ experiment. uRequire's wicked <a href="/uRequire/docs/types-and-derive#deriving-behaviors">config derivation</a> is using _B.Blender.</div><div class="advertisements">Using <a href="http://gruntjs.com">gruntjs</a> ? Check <a href="https://github.com/aearly/grunt-urequire">grunt-urequire</a>, where you can use <a href="/uRequire/docs/masterdefaultsconfig.coffee#config-usage">uRequire config</a> as a grunt task.</div><div class="advertisements">Related articles: <a href="http://addyosmani.com/writing-modular-js/">Writing Modular JavaScript With AMD, CommonJS & ES Harmony</a> and <a href="http://addyosmani.com/largescalejavascript/">Patterns For Large-Scale JavaScript Application Architecture</a> by <a href="http://twitter.com/addyosmani">Addy Osmani</a>.</div><div class="advertisements">Developed with a kindly sponsored free version of <a href="http://www.jetbrains.com/idea/"><img src="/uRequire/img/logo_intellij_idea.png"/></a></div></div></div></div></div></div><footer class="urequire-footer"><div class="inner"><div class="container"><ul class="pull-right"><li><a href="/contributing">Contributing</a></li><li class="social"><a href="https://github.com/anodynos/urequire" alt="uRequire on GitHub"><span class="icon-github"></span></a></li><li class="social"><a href="https://twitter.com/urequire/" alt="uRequire on Twitter"><span class="icon-twitter"></span></a></li></ul><ul class="pull-left"><li>uRequire is an open source project, MIT license. (C)<a href="http://github.com/anodynos" alt="anodynos"></a>Agelos Pikoulas 2013</li></ul></div></div></footer></body></html>